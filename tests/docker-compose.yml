services:
  browser:
    image: motion/motion-browser
    build:
      context: ..
      dockerfile_inline: |
        FROM mcr.microsoft.com/playwright:v1.54.2-jammy
        COPY LICENSE /app/LICENSE
        COPY tests /app/tests
        WORKDIR /app/tests
        RUN npm ci --no-audit --no-fund
        RUN npx playwright install --with-deps
        CMD ["/bin/bash", "-lc", "python3 -m http.server 9999 --bind 0.0.0.0"]
        HEALTHCHECK --interval=10s --timeout=3s --retries=3 --start-period=10s CMD ["wget", "-qO", "/dev/null", "http://127.0.0.1:9999"]
    container_name: ${SCOPE:-motion}-browser
    network_mode: bridge
